# scoreproject 仕様書

**作成日:** 2026-02-24
**フレームワーク:** Django 4.0
**言語:** Python 3.x
**データベース:** SQLite

---

## 1. システム概要

本システムは、学生向けの成績管理および掲示板機能を提供するWebアプリケーションである。学生番号による認証を用い、科目ごとの成績入力・閲覧・統計表示、および科目に関するコメント投稿機能を持つ。

---

## 2. システム構成

### 2.1 アプリケーション構成

```
scoreproject/
├── scoreproject/       # プロジェクト設定
├── score/              # 成績管理アプリ
├── accounts/           # ユーザー認証アプリ
└── omb/                # 掲示板アプリ
```

### 2.2 技術スタック

| 項目 | 技術 |
|------|------|
| フレームワーク | Django 4.0 |
| DB | SQLite (db.sqlite3) |
| フロントエンド | Bootstrap 5.2.3 |
| チャート | Chart.js 2.8.0 |
| アイコン | FontAwesome 6.3.0 |
| テーブル | Simple DataTables 7.1.2 |

### 2.3 主要設定 (settings.py)

| 設定 | 値 |
|------|----|
| 言語 | 日本語 (ja) |
| タイムゾーン | Asia/Tokyo |
| 認証ユーザーモデル | accounts.CustomUser |
| ログイン後リダイレクト | /score/ |
| ログアウト後リダイレクト | ログインページ |
| メディアURL | /media/ |
| スタティックURL | /static/ |

---

## 3. データモデル

### 3.1 CustomUser（accounts アプリ）

ユーザー情報を管理するモデル。Django標準の `AbstractUser` を継承。

| フィールド名 | 型 | 制約 | 説明 |
|---|---|---|---|
| student_number | CharField(20) | unique, required | 学生番号（usernameと同値） |
| email | EmailField | required | メールアドレス |
| grade | IntegerField | choices: 1/2/3 | 学年（1年生/2年生/3年生） |

- `save()` をオーバーライドし、`student_number` を `username` に自動設定

### 3.2 Subject（score アプリ）

科目情報を管理するモデル。

| フィールド名 | 型 | 制約 | 説明 |
|---|---|---|---|
| subject | CharField(50) | required | 科目名 |

### 3.3 Score（score アプリ）

成績情報を管理するモデル。

| フィールド名 | 型 | 制約 | 説明 |
|---|---|---|---|
| user | ForeignKey(CustomUser) | CASCADE | ユーザー |
| subject | ForeignKey(Subject) | PROTECT | 科目 |
| date | DateField | required | 受験/記録日 |
| score | IntegerField | 0〜100 | 点数 |
| posted_at | DateTimeField | auto_now_add | 登録日時 |

### 3.4 Profile（score アプリ）

ユーザープロフィール情報を管理するモデル。

| フィールド名 | 型 | 制約 | 説明 |
|---|---|---|---|
| user | ForeignKey(CustomUser) | CASCADE | ユーザー |
| name | CharField(100) | required | 表示名 |
| icon | ImageField | optional | アイコン画像（upload_to='icons'） |
| grade | IntegerField | required | 学年 |

### 3.5 OmbPost（omb アプリ）

掲示板の投稿を管理するモデル。

| フィールド名 | 型 | 制約 | 説明 |
|---|---|---|---|
| name | CharField(50) | required | 投稿者名/タイトル |
| subject | ForeignKey(Subject) | PROTECT | 関連科目 |
| comment | TextField | required | 投稿内容 |
| posted_at | DateTimeField | auto_now_add | 投稿日時 |

---

## 4. URL設計

### 4.1 ルートURL

| URLパス | 遷移先 |
|---------|--------|
| `/` | `/login/` へリダイレクト |
| `/admin/` | Django管理サイト |
| `/score/` | score アプリ |
| `/omb/` | omb アプリ |
| （その他） | accounts アプリ |

### 4.2 accounts アプリ URL

| URLパス | ビュー | 説明 |
|---------|--------|------|
| `/signup/` | SignUpView | ユーザー登録フォーム |
| `/signup-success/` | SignUpSuccessView | 登録完了ページ |
| `/login/` | LoginView | ログインフォーム |
| `/logout/` | LogoutView | ログアウト |
| `/password-reset/` | PasswordResetView | パスワードリセット申請 |
| `/password-reset/done/` | PasswordResetDoneView | リセットメール送信完了 |
| `/reset/<uidb64>/<token>/` | PasswordResetConfirmView | 新パスワード入力 |
| `/reset/done/` | PasswordResetCompleteView | リセット完了 |

### 4.3 score アプリ URL

| URLパス | ビュー | 説明 |
|---------|--------|------|
| `/score/` | IndexView | ダッシュボード（トップページ） |
| `/score/in-score/` | InScoreView | 成績入力フォーム |
| `/score/post_done/` | PostSuccessView | 入力完了ページ |
| `/score/detail/` | SubjectDetailView | 科目一覧・サマリー |
| `/score/subject/<int:pk>/` | SubjectScoreListView | 科目別成績一覧 |

### 4.4 omb アプリ URL

| URLパス | ビュー | 説明 |
|---------|--------|------|
| `/omb/` | IndexView | 掲示板トップページ |
| `/omb/list/` | OmbListView | 投稿一覧 |
| `/omb/post/` | OmbCreateView | 新規投稿フォーム |

---

## 5. 画面設計

### 5.1 画面一覧

| 画面名 | URL | テンプレート | 認証要否 |
|--------|-----|-------------|---------|
| ログイン | /login/ | accounts/login.html | 不要 |
| ユーザー登録 | /signup/ | accounts/signup.html | 不要 |
| 登録完了 | /signup-success/ | accounts/signup_success.html | 不要 |
| パスワードリセット申請 | /password-reset/ | accounts/password_reset.html | 不要 |
| メール送信完了 | /password-reset/done/ | accounts/password_reset_done.html | 不要 |
| 新パスワード設定 | /reset/.../  | accounts/password_reset_form.html | 不要 |
| ダッシュボード | /score/ | score/index.html | 要 |
| 成績入力 | /score/in-score/ | score/in-score.html | 要 |
| 入力完了 | /score/post_done/ | score/post_success.html | 要 |
| 科目一覧 | /score/detail/ | score/detail.html | 要 |
| 科目別成績一覧 | /score/subject/<pk>/ | score/subject_score_list.html | 要 |
| 掲示板トップ | /omb/ | omb/top.html | 要 |
| 投稿一覧 | /omb/list/ | omb/omb_list.html | 要 |
| 新規投稿 | /omb/post/ | omb/omb_post.html | 要 |

### 5.2 共通レイアウト

**認証後画面（score/base.html）**
- 左サイドバーナビゲーション
- 上部ナビバー
- Bootstrap 5ベースのレスポンシブデザイン

**認証画面（accounts/base2.html）**
- グラデーション背景
- 中央カードレイアウト

---

## 6. 機能仕様

### 6.1 ユーザー認証機能

#### 6.1.1 ユーザー登録
- 入力項目: 学生番号、メールアドレス、パスワード、パスワード（確認）
- 学生番号はuniqueで重複不可
- 登録完了後、登録完了ページへ遷移

#### 6.1.2 ログイン
- 入力項目: ユーザー名（学生番号）、パスワード
- ログイン成功後、ダッシュボード（/score/）へリダイレクト

#### 6.1.3 ログアウト
- ログアウト後、ログインページへリダイレクト

#### 6.1.4 パスワードリセット
- メールアドレスを入力してリセットリンクを送信
- メール送信: Outlook SMTP（smtp-mail.outlook.com:587、TLS）
- リンクからパスワード再設定可能

### 6.2 成績管理機能

#### 6.2.1 ダッシュボード（/score/）
表示内容:
- 総成績件数
- 登録科目数
- 直近の成績一覧テーブル（全件）

#### 6.2.2 成績入力（/score/in-score/）
- 入力項目: 日付、科目（プルダウン）、点数（0〜100）
- フォームバリデーション実装
- 送信後、完了ページへ遷移

#### 6.2.3 科目一覧（/score/detail/）
- 登録されている全科目をカードで表示
- 各カードに直近の点数と記録件数を表示
- カードをクリックすると科目別成績一覧へ遷移

#### 6.2.4 科目別成績一覧（/score/subject/<pk>/）
- 対象科目の全成績をテーブル表示（10件/ページでページネーション）
- 統計表示: 最高点・最低点・件数
- 成績評価バッジ:
  - 80点以上: 優秀
  - 60点以上: 良好
  - 60点未満: 要努力

### 6.3 掲示板機能（omb）

#### 6.3.1 掲示板トップ（/omb/）
- 投稿一覧へのリンクカード
- 新規投稿フォームへのリンクカード

#### 6.3.2 投稿一覧（/omb/list/）
- 全投稿をリスト表示（5件/ページでページネーション）
- 科目ボタンによるフィルタリング機能
- 表示項目: 投稿者名、科目、コメント、投稿日時

#### 6.3.3 新規投稿（/omb/post/）
- 入力項目: 投稿者名、科目（プルダウン）、コメント（テキストエリア）
- 送信後、投稿一覧ページへリダイレクト

---

## 7. フォーム仕様

### 7.1 ScoreForm（score/forms.py）

| フィールド | ウィジェット | バリデーション |
|-----------|------------|--------------|
| date | DateInput (type=date) | 必須 |
| subject | Select | 必須 |
| score | NumberInput (min=0, max=100) | 必須、0〜100 |

### 7.2 CustomUserCreationForm（accounts/forms.py）

| フィールド | バリデーション |
|-----------|--------------|
| student_number | 必須、unique |
| email | 必須、メール形式 |
| password1 | 必須、Djangoパスワードポリシー準拠 |
| password2 | 必須、password1と一致 |

### 7.3 OmbPostForm（omb/forms.py）

| フィールド | ウィジェット | バリデーション |
|-----------|------------|--------------|
| name | TextInput | 必須 |
| subject | Select | 必須 |
| comment | Textarea (3行) | 必須 |

---

## 8. 管理画面（Django Admin）

### 8.1 score アプリ

| モデル | 一覧表示フィールド | リンク |
|--------|-----------------|--------|
| Subject | subject | subject |
| Score | subject, score | subject, score |
| Profile | name, grade | name, grade |

### 8.2 accounts アプリ

| モデル | 一覧表示フィールド | リンク |
|--------|-----------------|--------|
| CustomUser | id, username | id, username |

### 8.3 omb アプリ

| モデル | 一覧表示フィールド | リンク |
|--------|-----------------|--------|
| OmbPost | id, name, subject, posted_at | id, name |

---

## 9. ディレクトリ構成（詳細）

```
scoreproject/
├── scoreproject/
│   ├── __init__.py
│   ├── settings.py        # プロジェクト設定
│   ├── urls.py            # ルートURL設定
│   ├── wsgi.py
│   └── asgi.py
├── score/
│   ├── models.py          # Subject, Score, Profile
│   ├── views.py           # IndexView, InScoreView, SubjectDetailView, etc.
│   ├── urls.py
│   ├── forms.py           # ScoreForm
│   ├── admin.py
│   ├── apps.py
│   ├── migrations/
│   ├── static/score/
│   │   ├── css/styles.css
│   │   └── js/
│   └── templates/score/
│       ├── base.html
│       ├── index.html
│       ├── in-score.html
│       ├── detail.html
│       ├── subject_score_list.html
│       └── post_success.html
├── accounts/
│   ├── models.py          # CustomUser
│   ├── views.py           # SignUpView, SignUpSuccessView
│   ├── urls.py
│   ├── forms.py           # CustomUserCreationForm
│   ├── admin.py
│   ├── apps.py
│   ├── migrations/
│   ├── static/accounts/
│   │   ├── css/styles.css
│   │   └── js/
│   └── templates/accounts/
│       ├── base2.html
│       ├── login.html
│       ├── signup.html
│       ├── signup_success.html
│       ├── logout.html
│       ├── password_reset.html
│       ├── password_reset_form.html
│       ├── password_reset_email.html
│       └── password_reset_done.html
├── omb/
│   ├── models.py          # OmbPost
│   ├── views.py           # IndexView, OmbListView, OmbCreateView
│   ├── urls.py
│   ├── forms.py           # OmbPostForm
│   ├── admin.py
│   ├── apps.py
│   ├── migrations/
│   └── templates/omb/
│       ├── top.html
│       ├── omb_list.html
│       ├── omb_post.html
│       └── pagination.html
├── manage.py
├── requirements.txt
└── db.sqlite3
```

---

## 10. 注意事項・既知の課題

### 10.1 開発環境向け設定（本番環境では要変更）

- `DEBUG = True` のまま
- `ALLOWED_HOSTS` が未設定（`[]`）
- `SECRET_KEY` がソースコードに直書き
- メール送信アカウント情報がソースコードに直書き

### 10.2 未実装・未統合機能

以下のテンプレートは存在するが、URLやビューとの統合が不完全な可能性がある:

- `accounts/mypage.html` - マイページ
- `accounts/profile_edit.html` - プロフィール編集
- `accounts/register.html` - 代替登録画面
- `score/index1.html` - 代替ダッシュボード

### 10.3 ページネーション

- 科目別成績一覧: 10件/ページ
- 掲示板投稿一覧: 5件/ページ
- `omb/pagination.html` を共通コンポーネントとして使用

---

*本仕様書は scoreproject の現状実装に基づき作成。*
